# yaml 配置
version: "3.6"
services:
  run_ice_via:
    container_name: ice_via_service
    restart: always
    network_mode: "host"
    image: {{ice_via_consul_image[0]["name"]}}:{{ice_via_consul_image[0]["tag"]}}
    volumes:
      - {{ deploy_dir }}/{{ice_via_dir_name}}/config/ice_grid.yml:{{ ice_via_docker_path }}/config/config.gridregistry
      - {{ deploy_dir }}/{{ice_via_dir_name}}/config/ice_glacier2.yml:{{ ice_via_docker_path }}/config/config.glacier2
      - {{ deploy_dir }}/{{ice_via_dir_name}}/config/ice_glacier2_ssl.yml:{{ ice_via_docker_path }}/config/config.ssl.glacier2
      - {{ deploy_dir }}/{{ice_via_dir_name}}/logs:{{ ice_via_docker_path }}/logs:rw
      - {{ deploy_dir }}/{{ice_via_dir_name}}/cert:{{ ice_via_docker_path }}/cert
      - {{ deploy_dir }}/{{ice_via_dir_name}}/deploy:{{ ice_via_docker_path }}/deploy
    command: 
      - sh
      - -c
      - |
          /Ice_Via_Consul/ice_via/bin/run_glacier2.sh &
          /Ice_Via_Consul/ice_via/bin/run_icegrid.sh
